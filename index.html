<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Activity Code Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Include the Proxima Nova font -->
  <link href="https://fonts.googleapis.com/css2?family=Proxima+Nova&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Proxima Nova', Arial, sans-serif;
      margin: 20px;
      padding: 20px;
    }
    /* Center the logo at the top */
    #logo-container {
      text-align: center;
      margin-bottom: 20px;
    }
    #logo {
      width: 300px; /* Adjust as needed */
    }

    h1 {
      font-size: 24px; /* Match the font size of the second script */
    }

    label, select, input, button {
      display: block;
      margin: 10px 0;
    }

    /* Specific styling for labels */
    label {
      font-weight: bold; /* Make all labels bold */
    }

    /* Increase size of input boxes and dropdowns */
    select, input, button {
      margin-top: 10px;
      padding: 12px;  /* Increased padding for larger size */
      width: 100%;
      max-width: 400px;  /* Adjust max-width for larger fields */
      font-size: 16px;   /* Increased font size */
    }

    /* Style for the results */
    #results {
      margin-top: 20px;
    }

    /* Non-bold result text */
    #results p {
      font-weight: normal;
    }

    /* Align checkboxes with labels */
    .checkbox-container {
      display: flex;
      align-items: center;
      margin: 10px 0;
    }

    .checkbox-container input[type="checkbox"] {
      margin-right: 10px;  /* Space between checkbox and label */
    }

  </style>
</head>
<body>

  <div id="logo-container">
    <img
      id="logo"
      src="https://raw.githubusercontent.com/gmcglynn88/Management-Unit-Search/main/Consultinglogo%20(2).png"
      alt="Company Logo"
    >
  </div>

  <h1>Manage Business Units and Activity Codes</h1>

  <!-- Business Units Dropdown -->
  <label for="business-units">Select Business Units:</label>
  <select id="business-units" multiple>
    <!-- Options will be populated dynamically via JavaScript -->
  </select>

  <button onclick="createActivityCode()">Create Activity Code for Selected Business Units</button>

  <div id="results">
    <!-- Results will be displayed here -->
  </div>

  <hr>

  <!-- Activity Code Creation Form -->
  <h2>Create Activity Code</h2>

  <label for="activity-name">Activity Name:</label>
  <input type="text" id="activity-name" placeholder="Enter activity name" required>

  <label for="category">Category:</label>
  <select id="category" required>
    <option value="">Select category</option>
    <option value="OnQueueWork">OnQueueWork</option>
    <option value="Break">Break</option>
    <option value="Meal">Meal</option>
    <option value="Meeting">Meeting</option>
    <option value="OffQueueWork">OffQueueWork</option>
    <option value="TimeOff">TimeOff</option>
    <option value="Training">Training</option>
    <option value="Unavailable">Unavailable</option>
    <option value="Unscheduled">Unscheduled</option>
  </select>

  <label for="length">Default Length (minutes):</label>
  <input type="number" id="length" placeholder="Enter default length">


  <!-- Aligning Checkboxes with Labels -->
  <div class="checkbox-container">
    <input type="checkbox" id="paid-time" value="countsAsPaidTime">
    <label for="paid-time">Counts as Paid Time</label>
  </div>

  <div class="checkbox-container">
    <input type="checkbox" id="work-time" value="countsAsWorkTime">
    <label for="work-time">Counts as Work Time</label>
  </div>

  <div class="checkbox-container">
    <input type="checkbox" id="time-off-selectable" value="agentTimeOffSelectable">
    <label for="time-off-selectable">Agent Time Off Selectable</label>
  </div>

  <div class="checkbox-container">
    <input type="checkbox" id="shrinkage" value="countsTowardShrinkage">
    <label for="shrinkage">Counts Toward Shrinkage</label>
  </div>

  <div class="checkbox-container">
    <input type="checkbox" id="planned-shrinkage" value="plannedShrinkage">
    <label for="planned-shrinkage">Planned Shrinkage</label>
  </div>

  <div class="checkbox-container">
    <input type="checkbox" id="interruptible" value="interruptible">
    <label for="interruptible">Interruptible</label>
  </div>

  <div id="results"></div>

  <script>
    // Function to fetch access token using Client ID and Client Secret
    async function getAccessToken() {
      const clientId = 'f93a488c-73e9-40cf-b4fd-5c05ff043c81';
      const clientSecret = 'G0qSDsjAtCutt5W-297Yqrwz9n4q3g3YdwpfnbchGcQ';
      
      const url = 'https://api.mypurecloud.ie/oauth/token';
      
      const body = new URLSearchParams();
      body.append('grant_type', 'client_credentials');
      body.append('client_id', clientId);
      body.append('client_secret', clientSecret);
      
      const response = await fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: body.toString(),
      });
      
      const data = await response.json();
      
      if (response.ok) {
        return data.access_token;
      } else {
        console.error('Error fetching access token:', data);
        throw new Error('Error fetching access token');
      }
    }

    // Function to fetch business units
    async function fetchBusinessUnits() {
      const accessToken = await getAccessToken(); // Obtain access token

      const apiUrl = 'https://api.mypurecloud.ie/api/v2/workforcemanagement/businessunits';
      
      const response = await fetch(apiUrl, {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${accessToken}`,
        },
      });
      
      const data = await response.json();
      
      if (response.ok) {
        const businessUnitsSelect = document.getElementById('business-units');
        data.forEach(unit => {
          const option = document.createElement('option');
          option.value = unit.id;
          option.textContent = unit.name;
          businessUnitsSelect.appendChild(option);
        });
      } else {
        console.error('Error fetching business units:', data);
      }
    }

    // Function to create the activity code
    async function createActivityCode() {
      const name = document.getElementById('activity-name').value;
      const category = document.getElementById('category').value;
      const lengthInMinutes = parseInt(document.getElementById('length').value, 10) || null;
      const countsAsPaidTime = document.getElementById('paid-time').checked;
      const countsAsWorkTime = document.getElementById('work-time').checked;
      const agentTimeOffSelectable = document.getElementById('time-off-selectable').checked;
      const countsTowardShrinkage = document.getElementById('shrinkage').checked;
      const plannedShrinkage = document.getElementById('planned-shrinkage').checked;
      const interruptible = document.getElementById('interruptible').checked;
      const businessUnits = Array.from(document.getElementById('business-units').selectedOptions).map(option => option.value);

      const accessToken = await getAccessToken(); // Get access token for API authentication

      const createUrl = `https://api.mypurecloud.ie/api/v2/workforcemanagement/businessunits/{businessUnitId}/activitycodes`;

      try {
        const response = await fetch(createUrl, {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${accessToken}`,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            name,
            category,
            lengthInMinutes,
            countsAsPaidTime,
            countsAsWorkTime,
            agentTimeOffSelectable,
            countsTowardShrinkage,
            plannedShrinkage,
            interruptible,
            businessUnits,
          }),
        });
        const data = await response.json();
        console.log('Activity code created:', data);
        document.getElementById('results').innerHTML = `<p>Activity code created successfully.</p>`;
      } catch (error) {
        console.error('Error creating activity code:', error);
        document.getElementById('results').innerHTML = `<p>Error creating activity code: ${error.message}</p>`;
      }
    }

    // Fetch business units on page load
    fetchBusinessUnits();
  </script>
</body>
</html>
